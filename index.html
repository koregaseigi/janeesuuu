<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>ZAZISU SORT V2.1</title> <style>
body {
  background-color: #ffffff;
  color: #000000;
  font-family: '돋움', sans-serif;
}

#mainTable {
  font-size: 12px;
  text-align: center;
  vertical-align: middle;
  width: auto;
  margin: auto;
  border-collapse: separate;
  border-spacing: 10px 5px;
}
#battleNumber {
  font-size: 24px;
  font-weight: bold;
  text-align: center;
  padding: 20px;
}

#leftField, #rightField {
  width: 350px; 
  height: auto; 
  border: none;
  vertical-align: top; 
  padding: 10px;
}

.member-name {
  font-size: 18px;
  font-weight: bold;
}
.member-card {
  width: 100%;
  padding: 10px 10px 20px 10px;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  align-items: center;
  border: 1px solid #eee;
  border-radius: 8px;
  background-color: #f9f9f9;
}

.middleField {
  width: 150px;
  height: 60px;
  border: none;
  border-radius: 12px;
  background-color: #fbefff;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 1px 1px 5px rgba(0,0,0,0.1);
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 5px auto;
  transition: background-color 0.2s ease;
}
.middleField:hover {
  background-color: #f3dfff;
}

.img-box {
  width: 300px; 
  height: 300px; 
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: white;
  margin: 0 auto 10px auto; 
  overflow: hidden; 
  cursor: pointer; 
  border: 1px solid #ccc;
}

.img-box img {
  max-height: 100%;
  max-width: 100%;
  object-fit: cover;
  object-position: center;
}
.img-url-display { 
  font-size: 10px;
  color: #666;
  text-align: center;
  word-break: break-all;
  margin-top: 5px;
  height: 2.5em; 
  overflow-y: auto; 
}
.button-container {
  margin-top: 15px;
  display: flex;
  justify-content: center;
  gap: 10px; 
}
.vote-button, .exclude-button {
  font-size: 14px; 
  padding: 8px 15px;
  cursor: pointer;
  border: none;
  border-radius: 20px;
  box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
  transition: all 0.2s ease-in-out;
}

.vote-button {
  background-color: #ffccdd;
}
.vote-button:hover {
  background-color: #ff99bb;
  transform: scale(1.05);
}
.exclude-button {
  background-color: #lightgray;
}
.exclude-button:hover {
  background-color: #gray;
  color: white;
  transform: scale(1.05);
}

#resultField table {
    width: auto; 
    max-width: 600px; 
    font-size:12px;
    margin:auto;
    border:1px solid #000;
    border-collapse:collapse;
}
#resultField th, #resultField td {
    border:1px solid #000;
    padding: 5px;
    text-align: left;
}
#resultField th {
    background:black;
    color:white;
    text-align: center;
}
#resultField .result-rank {
    text-align: right;
    width: 50px;
}
#resultField .result-name-cell {
    word-break: keep-all; 
}
#resultField .img-box {
    width: 50px;
    height: 50px;
    margin: 0 5px 0 0;
    float: left;
    border: none;
}
#resultField .img-box img {
    object-fit: cover;
}
#resultField .img-url-display {
    display: none; 
}
#resultField .member-name {
    font-size: 14px;
}
#resultField br {
    display: none; 
}
#excludedNamesList { /* Style for excluded names list */
    margin-top: 20px;
    font-size: 14px;
    color: #333;
    text-align: center;
}

</style>

<script>

var allMembers = [
  { id: 0, nameStr: "니시키도 료", images: ['https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FsKpf5%2Fbtq6Q6A61Nr%2FPVIrRAFXCLOxoflA4T3IA0%2Fimg.gif'], imageDisplayUrls: ['https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FsKpf5%2Fbtq6Q6A61Nr%2FPVIrRAFXCLOxoflA4T3IA0%2Fimg.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 1, nameStr: "시부타니 스바루", images: ['https://nationaltcc.org/wp-content/uploads/2021/02/9929e8bebd580f8e678ee5eb68d756f9.jpg'], imageDisplayUrls: ['https://nationaltcc.org/wp-content/uploads/2021/02/9929e8bebd580f8e678ee5eb68d756f9.jpg'], currentImageIndex: 0, isExcluded: true },
  { id: 2, nameStr: "야마다 료스케", images: ['https://file3.instiz.net/data/cached_img/upload/2018/08/23/2/8de59880c5c76bc78ee73a736c91d6e1.gif'], imageDisplayUrls: ['https://file3.instiz.net/data/cached_img/upload/2018/08/23/2/8de59880c5c76bc78ee73a736c91d6e1.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 3, nameStr: "치넨 유리", images: ['https://i.namu.wiki/i/yhrJfVan6wqbStXhKDw23aukcG0Ta71iP9JYqH57P7f2AK7SKc9AT5ok3rgcjR-QSNhcsjeaHbDmTJ-UsgMmAw.gif'], imageDisplayUrls: ['https://i.namu.wiki/i/yhrJfVan6wqbStXhKDw23aukcG0Ta71iP9JYqH57P7f2AK7SKc9AT5ok3rgcjR-QSNhcsjeaHbDmTJ-UsgMmAw.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 4, nameStr: "나카지마 유토", images: ['https://blog.kakaocdn.net/dn/c6v7kn/btrRoqgfL45/0VQC1Fidc8kz8esD5pOSJ1/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/c6v7kn/btrRoqgfL45/0VQC1Fidc8kz8esD5pOSJ1/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 5, nameStr: "아리오카 다이키", images: ['https://blog.kakaocdn.net/dn/GwjdH/btqCzBWShjE/KrWZZz0A1k6HESPkja4PQk/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/GwjdH/btqCzBWShjE/KrWZZz0A1k6HESPkja4PQk/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 6, nameStr: "타카키 유야", images: ['https://i.namu.wiki/i/3Q0VBEyTss3REQj7yY3YSGa_OhAL1rDmTmhEfE1Ez6b-lVjjXgUsDSHd2KbQV4Y1gMj3R8JAh1xYMeD9jkQFzA.gif'], imageDisplayUrls: ['https://i.namu.wiki/i/3Q0VBEyTss3REQj7yY3YSGa_OhAL1rDmTmhEfE1Ez6b-lVjjXgUsDSHd2KbQV4Y1gMj3R8JAh1xYMeD9jkQFzA.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 7, nameStr: "이노오 케이", images: ['https://i.namu.wiki/i/f701qZiNCVsgZqoHqFnLbdxdX5p75OgtpvmbpjT25b1pq-1h3RG508t_ggTeGgA7xF4A8BAsde4L23ITfA2mww.gif'], imageDisplayUrls: ['https://i.namu.wiki/i/f701qZiNCVsgZqoHqFnLbdxdX5p75OgtpvmbpjT25b1pq-1h3RG508t_ggTeGgA7xF4A8BAsde4L23ITfA2mww.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 8, nameStr: "야오토메 히카루", images: ['https://img.tvreportcdn.de/cms-content/uploads/2024/08/14/c7e3a0a5-5b72-4c52-9124-46215c9a11ce.jpg'], imageDisplayUrls: ['https://img.tvreportcdn.de/cms-content/uploads/2024/08/14/c7e3a0a5-5b72-4c52-9124-46215c9a11ce.jpg'], currentImageIndex: 0, isExcluded: true },
  { id: 9, nameStr: "마스다 타카히사", images: ['https://blog.kakaocdn.net/dn/bWjqnb/btqG3kbWire/TWmkNdfX5eR0XZrscD7MMk/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/bWjqnb/btqG3kbWire/TWmkNdfX5eR0XZrscD7MMk/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 10, nameStr: "코야마 케이치로", images: ['https://blog.kakaocdn.net/dn/DB5e6/btqG4bZ8Kli/N6J8O1UNGJlaD2sdDFg30K/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/DB5e6/btqG4bZ8Kli/N6J8O1UNGJlaD2sdDFg30K/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 11, nameStr: "센가 켄토", images: ['https://www.nautiljon.com/images/more/05/08/456580.webp'], imageDisplayUrls: ['https://www.nautiljon.com/images/more/05/08/456580.webp'], currentImageIndex: 0, isExcluded: true },
  { id: 12, nameStr: "미야타 토시야", images: ['https://blog.kakaocdn.net/dn/7RBTX/btqIxZeKaOj/43fiCgy8rickZ3VZ8Hfk6K/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/7RBTX/btqIxZeKaOj/43fiCgy8rickZ3VZ8Hfk6K/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 13, nameStr: "요코오 와타루", images: ['https://img1.daumcdn.net/thumb/R800x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FnDgjv%2FbtquR2O9muS%2FtWonJUz1l9W661n6hEysT0%2Fimg.gif'], imageDisplayUrls: ['https://img1.daumcdn.net/thumb/R800x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FnDgjv%2FbtquR2O9muS%2FtWonJUz1l9W661n6hEysT0%2Fimg.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 14, nameStr: "후지가야 타이스케", images: ['https://blog.kakaocdn.net/dn/B6QA0/btquXuxj4XC/RYltFP38PrxNsQpCbtee8k/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/B6QA0/btquXuxj4XC/RYltFP38PrxNsQpCbtee8k/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 15, nameStr: "타마모리 유타", images: ['https://img1.daumcdn.net/thumb/R720x0.q80/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F99CFBD46602B913918'], imageDisplayUrls: ['https://img1.daumcdn.net/thumb/R720x0.q80/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F99CFBD46602B913918'], currentImageIndex: 0, isExcluded: true },
  { id: 16, nameStr: "니카이도 타카시", images: ['https://mblogthumb-phinf.pstatic.net/MjAxODA5MjdfMTEx/MDAxNTM4MDQ4ODQwOTAw.5J_OUWW3ebgmROmEY8qWxDfB8LON6_K6WljdsJhuz_gg.R7jV0eY20ZLdZawomxC_OSnsKQdLZjzbenu-GsvHN6Yg.GIF.luckyemma77/%EB%88%84%EC%BF%A0%EB%88%84%EC%BF%A0%EB%8B%88%EC%B9%B42.gif?type=w800'], imageDisplayUrls: ['https://mblogthumb-phinf.pstatic.net/MjAxODA5MjdfMTEx/MDAxNTM4MDQ4ODQwOTAw.5J_OUWW3ebgmROmEY8qWxDfB8LON6_K6WljdsJhuz_gg.R7jV0eY20ZLdZawomxC_OSnsKQdLZjzbenu-GsvHN6Yg.GIF.luckyemma77/%EB%88%84%EC%BF%A0%EB%88%84%EC%BF%A0%EB%8B%88%EC%B9%B42.gif?type=w800'], currentImageIndex: 0, isExcluded: true },
  { id: 17, nameStr: "사토 쇼리", images: ['https://imagedelivery.net/ISo6CJNY0e5_7mxZ2B_Wzg/bd3eb1c3-12b5-4273-ad41-f068a35fbd01/public?exp=1748807359&sig=3339f6f94babe01536826db57126a2de64b4f8437a6328ad88900ef466c13d18'], imageDisplayUrls: ['https://imagedelivery.net/ISo6CJNY0e5_7mxZ2B_Wzg/bd3eb1c3-12b5-4273-ad41-f068a35fbd01/public?exp=1748807359&sig=3339f6f94babe01536826db57126a2de64b4f8437a6328ad88900ef466c13d18'], currentImageIndex: 0, isExcluded: true },
  { id: 18, nameStr: "키쿠치 후마", images: ['https://pbs.twimg.com/media/Gi9J077a4AEKOgf?format=jpg&name=large'], imageDisplayUrls: ['https://pbs.twimg.com/media/Gi9J077a4AEKOgf?format=jpg&name=large'], currentImageIndex: 0, isExcluded: true },
  { id: 19, nameStr: "마츠시마 소우", images: ['https://pbs.twimg.com/media/F1HyrbsakAAiv3G?format=jpg&name=large'], imageDisplayUrls: ['https://pbs.twimg.com/media/F1HyrbsakAAiv3G?format=jpg&name=large'], currentImageIndex: 0, isExcluded: true },
  { id: 20, nameStr: "테라니시 타쿠토", images: ['https://img-store.theqoo.net/vKUwF.jpg'], imageDisplayUrls: ['https://img-store.theqoo.net/vKUwF.jpg'], currentImageIndex: 0, isExcluded: true },
  { id: 21, nameStr: "하라 요시타카", images: ['https://img.jisin.jp/uploads/2025/04/hara_yoshitaka_insta_1_line_tw.jpg.webp'], imageDisplayUrls: ['https://img.jisin.jp/uploads/2025/04/hara_yoshitaka_insta_1_line_tw.jpg.webp'], currentImageIndex: 0, isExcluded: true },
  { id: 22, nameStr: "하시모토 마사키", images: ['https://pbs.twimg.com/media/GsSbolmaMAEirTV?format=jpg&name=small'], imageDisplayUrls: ['https://pbs.twimg.com/media/GsSbolmaMAEirTV?format=jpg&name=small'], currentImageIndex: 0, isExcluded: true },
  { id: 23, nameStr: "이노마타 슈토", images: ['https://pbs.twimg.com/media/GjzQGawaoAAJ9PB.jpg'], imageDisplayUrls: ['https://pbs.twimg.com/media/GjzQGawaoAAJ9PB.jpg'], currentImageIndex: 0, isExcluded: true },
  { id: 24, nameStr: "시노즈카 타이키", images: ['https://pbs.twimg.com/media/GjzQGawaoAAJ9PB.jpg'], imageDisplayUrls: ['https://pbs.twimg.com/media/GjzQGawaoAAJ9PB.jpg'], currentImageIndex: 0, isExcluded: true },
  { id: 25, nameStr: "시게오카 다이키", images: ['https://i.namu.wiki/i/kk-a6nYCSeKG9qo1mPAVUsMH5PoecLb6NIHalwQQcEHtFn7x-0PtWtTwlI1LuAyneIeAaqRorJQlaF1EYvvYEQ.gif'], imageDisplayUrls: ['https://i.namu.wiki/i/kk-a6nYCSeKG9qo1mPAVUsMH5PoecLb6NIHalwQQcEHtFn7x-0PtWtTwlI1LuAyneIeAaqRorJQlaF1EYvvYEQ.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 26, nameStr: "키리야마 아키토", images: ['https://img1.daumcdn.net/thumb/R800x0/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F99541B3A5BE8AFDC2C'], imageDisplayUrls: ['https://img1.daumcdn.net/thumb/R800x0/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F99541B3A5BE8AFDC2C'], currentImageIndex: 0, isExcluded: true },
  { id: 27, nameStr: "나카마 준타", images: ['https://blog.kakaocdn.net/dn/2Gkde/btqEZ96gHEF/FaBB5kg4zB6x6QEtPKAFxk/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/2Gkde/btqEZ96gHEF/FaBB5kg4zB6x6QEtPKAFxk/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 28, nameStr: "카미야마 토모히로", images: ['https://t1.daumcdn.net/cfile/tistory/9920FC4D5B938C401B'], imageDisplayUrls: ['https://t1.daumcdn.net/cfile/tistory/9920FC4D5B938C401B'], currentImageIndex: 0, isExcluded: true },
  { id: 29, nameStr: "후지이 류세이", images: ['https://img1.daumcdn.net/thumb/R720x0.q80/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F999FA4385CBACF932B'], imageDisplayUrls: ['https://img1.daumcdn.net/thumb/R720x0.q80/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F999FA4385CBACF932B'], currentImageIndex: 0, isExcluded: true },
  { id: 30, nameStr: "하마다 타카히로", images: ['https://img1.daumcdn.net/thumb/R800x0/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F2268374258496B9237'], imageDisplayUrls: ['https://img1.daumcdn.net/thumb/R800x0/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F2268374258496B9237'], currentImageIndex: 0, isExcluded: true },
  { id: 31, nameStr: "코타키 노조무", images: ['https://t1.daumcdn.net/cfile/tistory/99A862435DF2E89F2C'], imageDisplayUrls: ['https://t1.daumcdn.net/cfile/tistory/99A862435DF2E89F2C'], currentImageIndex: 0, isExcluded: true },
  { id: 32, nameStr: "제시", images: ['https://blog.kakaocdn.net/dn/ok0lF/btqC9OBpJUb/Lo3UbP6Z0V6qwzJfLObKa1/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/ok0lF/btqC9OBpJUb/Lo3UbP6Z0V6qwzJfLObKa1/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 33, nameStr: "쿄모토 타이가", images: ['https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FIAxaR%2FbtqF1BOt570%2FfPVPXMRSOT072hFlNV9340%2Fimg.gif'], imageDisplayUrls: ['https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FIAxaR%2FbtqF1BOt570%2FfPVPXMRSOT072hFlNV9340%2Fimg.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 34, nameStr: "마츠무라 호쿠토", images: ['https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fbjsw5l%2FbtqJVpI1Ynj%2FWgMr0zShnkKwLtTdJNCsd0%2Fimg.gif'], imageDisplayUrls: ['https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fbjsw5l%2FbtqJVpI1Ynj%2FWgMr0zShnkKwLtTdJNCsd0%2Fimg.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 35, nameStr: "코우치 유고", images: ['https://blog.kakaocdn.net/dn/cvh8o2/btqE00U6bxN/HtCgk6TarX3gbJfC5TCSKK/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/cvh8o2/btqE00U6bxN/HtCgk6TarX3gbJfC5TCSKK/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 36, nameStr: "모리모토 신타로", images: ['https://blog.kakaocdn.net/dn/bpqkWj/btrMrSvQbKx/khF3VvAMY9Ya5OspO8scTK/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/bpqkWj/btrMrSvQbKx/khF3VvAMY9Ya5OspO8scTK/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 37, nameStr: "타나카 쥬리", images: ['https://blog.kakaocdn.net/dn/HwUiP/btqF3TN2rAH/SF5k8oE3jOWT6AG6Kk1yNK/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/HwUiP/btqF3TN2rAH/SF5k8oE3jOWT6AG6Kk1yNK/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 38, nameStr: "이와모토 히카루", images: ['https://blog.kakaocdn.net/dn/blsOZH/btqQIaTK6wx/jyokPvfTdYLHhCXnFFL5KK/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/blsOZH/btqQIaTK6wx/jyokPvfTdYLHhCXnFFL5KK/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 39, nameStr: "후카자와 타츠야", images: ['https://blog.kakaocdn.net/dn/yWyb6/btqMJFblVTj/3oDdInZyYzqYDKUrac8Cs1/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/yWyb6/btqMJFblVTj/3oDdInZyYzqYDKUrac8Cs1/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 40, nameStr: "라울", images: ['https://blog.kakaocdn.net/dn/db1cuc/btsBqMduW06/uYteuHLtwqokTLMvR0GcR0/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/db1cuc/btsBqMduW06/uYteuHLtwqokTLMvR0GcR0/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 41, nameStr: "와타나베 쇼타", images: ['https://blog.kakaocdn.net/dn/WhqEL/btsBMQlQHLp/B7xZXpmxXc70NTdEGIOcDK/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/WhqEL/btsBMQlQHLp/B7xZXpmxXc70NTdEGIOcDK/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 42, nameStr: "무카이 코지", images: ['https://blog.kakaocdn.net/dn/czBtJu/btrwsJFOyYd/CzKrWIqQtMIZck4qEbyfpK/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/czBtJu/btrwsJFOyYd/CzKrWIqQtMIZck4qEbyfpK/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 43, nameStr: "아베 료헤이", images: ['https://blog.kakaocdn.net/dn/ccgcCd/btqOlevtL7k/aTVDDYotePxe0PQutnKk4K/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/ccgcCd/btqOlevtL7k/aTVDDYotePxe0PQutnKk4K/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 44, nameStr: "메구로 렌", images: ['https://blog.kakaocdn.net/dn/emLPBQ/btrN4xPTyUV/XJvskbDwPUP1fHN13M5i51/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/emLPBQ/btrN4xPTyUV/XJvskbDwPUP1fHN13M5i51/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 45, nameStr: "미야다테 료타", images: ['https://blog.kakaocdn.net/dn/mDJEn/btqN2VK4O9J/W2UNUFaexPEk7m6zV5kBI0/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/mDJEn/btqN2VK4O9J/W2UNUFaexPEk7m6zV5kBI0/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 46, nameStr: "사쿠마 다이스케", images: ['https://blog.kakaocdn.net/dn/PIgiH/btqNXE3rHeD/hvXAv1qwqwAYLK3Pq850hk/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/PIgiH/btqNXE3rHeD/hvXAv1qwqwAYLK3Pq850hk/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 47, nameStr: "니시하타 다이고", images: ['https://blog.kakaocdn.net/dn/QVFjG/btrl0aNWJMp/tel0g8EEqVokzyQkBdexP0/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/QVFjG/btrl0aNWJMp/tel0g8EEqVokzyQkBdexP0/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 48, nameStr: "오오니시 류세이", images: ['https://blog.kakaocdn.net/dn/ubtyi/btrLiBNHg6q/ABO9Mlkx0Sa9r3S0MEsD8k/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/ubtyi/btrLiBNHg6q/ABO9Mlkx0Sa9r3S0MEsD8k/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 49, nameStr: "미치에다 슌스케", images: ['https://blog.kakaocdn.net/dn/ldqac/btrnDFFXBRd/ZW2IyPnN1tf2End3qQMqKk/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/ldqac/btrnDFFXBRd/ZW2IyPnN1tf2End3qQMqKk/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 50, nameStr: "타카하시 쿄헤이", images: ['https://blog.kakaocdn.net/dn/c5pbfd/btrKVwOrH9R/Kto2vhYKacEXqJeTwOdyf1/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/c5pbfd/btrKVwOrH9R/Kto2vhYKacEXqJeTwOdyf1/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 51, nameStr: "나가오 켄토", images: ['https://blog.kakaocdn.net/dn/NAdBI/btrMIc1B93M/mwFzcUb6aXzEJyyl0r6ChK/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/NAdBI/btrMIc1B93M/mwFzcUb6aXzEJyyl0r6ChK/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 52, nameStr: "후지와라 죠이치로", images: ['https://blog.kakaocdn.net/dn/WBnYv/btquwodOUad/rgyDkJJYO9SrgAmDU2lqMK/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/WBnYv/btquwodOUad/rgyDkJJYO9SrgAmDU2lqMK/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 53, nameStr: "오오하시 카즈야", images: ['https://blog.kakaocdn.net/dn/dAJ8Ux/btqwAScjosY/Rakk5IXsKQ8ps90WKXKiUk/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/dAJ8Ux/btqwAScjosY/Rakk5IXsKQ8ps90WKXKiUk/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 54, nameStr: "카와시마 노에루", images: ['https://blog.kakaocdn.net/dn/rLO6F/btqGGZ7YGe0/5DBu3KUW6kdz5IuZthb5Q0/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/rLO6F/btqGGZ7YGe0/5DBu3KUW6kdz5IuZthb5Q0/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 55, nameStr: "시메카케 류야", images: ['https://blog.kakaocdn.net/dn/b6Xo8F/btqSGkmhR0i/gOkFfwinIRTUpMkYeNPsnK/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/b6Xo8F/btqSGkmhR0i/gOkFfwinIRTUpMkYeNPsnK/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 56, nameStr: "요시자와 시즈야", images: ['https://blog.kakaocdn.net/dn/OwDRQ/btsgL9Ncf4O/mlkmj9TRQi0clShbZ7HPAK/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/OwDRQ/btsgL9Ncf4O/mlkmj9TRQi0clShbZ7HPAK/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 57, nameStr: "나카무라 카이토", images: ['https://pbs.twimg.com/media/FxastrJaYAAaJP-?format=jpg&name=medium'], imageDisplayUrls: ['https://pbs.twimg.com/media/FxastrJaYAAaJP-?format=jpg&name=medium'], currentImageIndex: 0, isExcluded: true },
  { id: 58, nameStr: "미야치카 카이토", images: ['https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fydht2%2FbtqGusoojnY%2FXxXX9pCi9jHGyvsuf1lBm0%2Fimg.gif'], imageDisplayUrls: ['https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fydht2%2FbtqGusoojnY%2FXxXX9pCi9jHGyvsuf1lBm0%2Fimg.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 59, nameStr: "마츠쿠라 카이토", images: ['https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FA32Zc%2FbtqGmQjKusU%2F6wSDSY6CDHkq54NiHkR6QK%2Fimg.gif'], imageDisplayUrls: ['https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FA32Zc%2FbtqGmQjKusU%2F6wSDSY6CDHkq54NiHkR6QK%2Fimg.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 60, nameStr: "마츠다 겐타", images: ['https://blog.kakaocdn.net/dn/WmwPL/btqLGYbuSiZ/yIe4yeRUgJLwi28GywBYV0/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/WmwPL/btqLGYbuSiZ/yIe4yeRUgJLwi28GywBYV0/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 61, nameStr: "마사카도 요시노리", images: ['https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F99954D4E5EBD1DA03A'], imageDisplayUrls: ['https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F99954D4E5EBD1DA03A'], currentImageIndex: 0, isExcluded: true },
  { id: 62, nameStr: "스에자와 세이야", images: ['https://1.bp.blogspot.com/-86JklF5U_oQ/YGBwU-Fr3OI/AAAAAAAAD90/--pxNL5BFNYb328UBOZF57sRMKbpbbHdwCLcBGAsYHQ/s0/WIFE9_SUE1.gif'], imageDisplayUrls: ['https://1.bp.blogspot.com/-86JklF5U_oQ/YGBwU-Fr3OI/AAAAAAAAD90/--pxNL5BFNYb328UBOZF57sRMKbpbbHdwCLcBGAsYHQ/s0/WIFE9_SUE1.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 63, nameStr: "쿠사마 리챠드 케이타", images: ['https://pbs.twimg.com/media/F6bmKy2boAAvSew.jpg'], imageDisplayUrls: ['https://pbs.twimg.com/media/F6bmKy2boAAvSew.jpg'], currentImageIndex: 0, isExcluded: true },
  { id: 64, nameStr: "코지마 켄", images: ['https://i.namu.wiki/i/l30_MTb2T2C_75mHXeplg0fTEtt55IR0p0D-q6kLdGpPjOUyLsd6c5TUT4AjGqIE2Jq8OIFbDwwyzJW4AN92sA.webp'], imageDisplayUrls: ['https://i.namu.wiki/i/l30_MTb2T2C_75mHXeplg0fTEtt55IR0p0D-q6kLdGpPjOUyLsd6c5TUT4AjGqIE2Jq8OIFbDwwyzJW4AN92sA.webp'], currentImageIndex: 0, isExcluded: true },
  { id: 65, nameStr: "사노 마사야", images: ['https://i.namu.wiki/i/3KsTi82YPFvObyu7wsEeeGfzH-meCICiVl5ZyOl7p-XcBjvxSAmCnyz0zHqmW7Mtf937MIPjnaGf9m_Tt65Fng.webp'], imageDisplayUrls: ['https://i.namu.wiki/i/3KsTi82YPFvObyu7wsEeeGfzH-meCICiVl5ZyOl7p-XcBjvxSAmCnyz0zHqmW7Mtf937MIPjnaGf9m_Tt65Fng.webp'], currentImageIndex: 0, isExcluded: true },
  { id: 66, nameStr: "아이바 마사키", images: ['https://blog.kakaocdn.net/dn/cViDOP/btqBEAYE2Xp/OGyNkyApJ9NZEWAr8P4W91/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/cViDOP/btqBEAYE2Xp/OGyNkyApJ9NZEWAr8P4W91/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 67, nameStr: "마츠모토 준", images: ['https://mblogthumb-phinf.pstatic.net/MjAxODA1MTdfODUg/MDAxNTI2NTI1NzI4MzUz.gRk5a69PRusCh-aNI19jvowTzp2oOQjfxSfAUD3deAog.li9mg8QnvkfL9d8lEdpudaZbpK50gxREJ5m1S5EZjc8g.GIF.kangon3104/IMG_5616.GIF?type=w966'], imageDisplayUrls: ['https://mblogthumb-phinf.pstatic.net/MjAxODA1MTdfODUg/MDAxNTI2NTI1NzI4MzUz.gRk5a69PRusCh-aNI19jvowTzp2oOQjfxSfAUD3deAog.li9mg8QnvkfL9d8lEdpudaZbpK50gxREJ5m1S5EZjc8g.GIF.kangon3104/IMG_5616.GIF?type=w966'], currentImageIndex: 0, isExcluded: true },
  { id: 68, nameStr: "니노미야 카즈나리", images: ['https://mblogthumb-phinf.pstatic.net/MjAxNzA3MjhfMjcx/MDAxNTAxMjQzMjA4MjQy.WkkBl8YWCg99-Ff6JRpKA46wgo3-OvAB7uT9Qi8amoMg.fNy1ZGDmieM7mL5PqUK9sZzYeLO6ApaBXZOMD_VhGasg.GIF.o0617o/%ED%91%B811.gif?type=w800'], imageDisplayUrls: ['https://mblogthumb-phinf.pstatic.net/MjAxNzA3MjhfMjcx/MDAxNTAxMjQzMjA4MjQy.WkkBl8YWCg99-Ff6JRpKA46wgo3-OvAB7uT9Qi8amoMg.fNy1ZGDmieM7mL5PqUK9sZzYeLO6ApaBXZOMD_VhGasg.GIF.o0617o/%ED%91%B811.gif?type=w800'], currentImageIndex: 0, isExcluded: true },
  { id: 69, nameStr: "오노 사토시", images: ['https://fimg4.pann.com/new/download.jsp?FileID=45134955'], imageDisplayUrls: ['https://fimg4.pann.com/new/download.jsp?FileID=45134955'], currentImageIndex: 0, isExcluded: true },
  { id: 70, nameStr: "나가세 렌", images: ['https://pbs.twimg.com/media/Gmk6-mLaEAUTNb_?format=jpg&name=large'], imageDisplayUrls: ['https://pbs.twimg.com/media/Gmk6-mLaEAUTNb_?format=jpg&name=large'], currentImageIndex: 0, isExcluded: true },
  { id: 71, nameStr: "사쿠라이 쇼", images: ['https://pbs.twimg.com/media/EnRiDJjUcAMliHi?format=jpg&name=small'], imageDisplayUrls: ['https://pbs.twimg.com/media/EnRiDJjUcAMliHi?format=jpg&name=small'], currentImageIndex: 0, isExcluded: true },
  { id: 72, nameStr: "타카하시 카이토", images: ['https://blog.kakaocdn.net/dn/cMb20o/btqOuIcSseA/wPXLpKKf9bAmPYYD6k9XJk/img.gif'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/cMb20o/btqOuIcSseA/wPXLpKKf9bAmPYYD6k9XJk/img.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 73, nameStr: "나카지마 켄토", images: ['https://i.namu.wiki/i/HndK3MJDkI_DcYHyHLsCtbohfWZUD9MEdBclQzxQnInpMHtzU8m0JyRSk84bKeWLqL6wrWrLpo7vqFMqDraSoA.gif'], imageDisplayUrls: ['https://i.namu.wiki/i/HndK3MJDkI_DcYHyHLsCtbohfWZUD9MEdBclQzxQnInpMHtzU8m0JyRSk84bKeWLqL6wrWrLpo7vqFMqDraSoA.gif'], currentImageIndex: 0, isExcluded: true },
  { id: 74, nameStr: "카자마 슌스케", images: ['https://blog.kakaocdn.net/dn/cepTtW/btq9taglQLU/qvkeWOm1weblRm1TL0hrI0/img.jpg'], imageDisplayUrls: ['https://blog.kakaocdn.net/dn/cepTtW/btq9taglQLU/qvkeWOm1weblRm1TL0hrI0/img.jpg'], currentImageIndex: 0, isExcluded: true }
];


function parseOldMemberString(htmlString, indexOffset) {
    const imgMatch = htmlString.match(/<img src='(.*?)'>/);
    const urlMatch = htmlString.match(/<div class='img-url'>(.*?)<\/div>/);
    const nameMatch = htmlString.match(/<span class='member-name'>(.*?)<\/span>/);

    const imageUrl = imgMatch ? imgMatch[1] : 'https://via.placeholder.com/300?text=Image+Not+Found';
    const displayUrl = urlMatch ? urlMatch[1] : 'URL not found';
    const nameStr = nameMatch ? nameMatch[1].replace(/<[^>]*>?/gm, '') : 'Unknown Name'; 

    return {
        id: indexOffset,
        nameStr: nameStr.trim(),
        images: [imageUrl],
        imageDisplayUrls: [displayUrl],
        currentImageIndex: 0,
        isExcluded: true
    };
}

oldFormatMembers.forEach((htmlString, index) => {
    allMembers.push(parseOldMemberString(htmlString, allMembers.length));
});


var lstMember = [], parent = [], equal = [], rec = [];
var cmp1, cmp2, head1, head2, nrec;
var numQuestion, initialTotalSize, currentTotalActiveMembers, finishSize, finishFlag;

const nameExceptions = {
  "라울": "https://namu.wiki/w/라울(Snow%20Man)",
  "제시": "https://namu.wiki/w/제시(SixTONES)"
};

allMembers.forEach(member => {
    const trimmedName = member.nameStr.trim();
    if (nameExceptions.hasOwnProperty(trimmedName)) {
        member.wikiLink = nameExceptions[trimmedName];
    } else {
        member.wikiLink = `https://namu.wiki/w/${encodeURIComponent(trimmedName)}`;
    }
});


function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function initList(){
  let activeMembersIndices = allMembers
    .map((member, index) => member.isExcluded ? -1 : index)
    .filter(index => index !== -1);

  if (activeMembersIndices.length < 2) {
      document.getElementById("battleNumber").innerHTML = "Not enough members to sort!";
      if (activeMembersIndices.length === 1) {
          const winner = allMembers[activeMembersIndices[0]];
          document.getElementById("resultField").innerHTML = 
            `<h2>🏆 최종 선택 🏆</h2>
             <div class="member-card" style="width:300px; margin:auto;">
               ${getMemberCardHTML(winner.id, 'result')}
             </div>`;
      } else {
          document.getElementById("resultField").innerHTML = "모든 후보가 제외되었습니다.";
      }
      const excludedMembers = allMembers.filter(m => m.isExcluded);
      if (excludedMembers.length > 0) {
          const excludedNames = excludedMembers.map(m => m.nameStr).join(", ");
          document.getElementById("resultField").innerHTML += `<div id="excludedNamesList">제외 된 이름: ${excludedNames}</div>`;
      }
      finishFlag = 1;
      return;
  }

  lstMember = []; 
  parent = [];
  equal = []; 
  rec = [];

  let n = 0;
  lstMember[n] = [...activeMembersIndices]; 
  parent[n] = -1;
  
  initialTotalSize = 0; 

  n++;
  for (let i = 0; i < lstMember.length; i++) {
    if (lstMember[i].length >= 2) {
      let mid = Math.ceil(lstMember[i].length / 2);
      lstMember[n] = lstMember[i].slice(0, mid);
      initialTotalSize += lstMember[n].length;
      parent[n++] = i;
      lstMember[n] = lstMember[i].slice(mid);
      initialTotalSize += lstMember[n].length;
      parent[n++] = i;
    }
  }
  
  currentTotalActiveMembers = activeMembersIndices.length; 

  for (let i = 0; i < allMembers.length; i++) equal[i] = -1;
  for (let i = 0; i < allMembers.length; i++) rec[i] = 0;


  nrec = 0;
  cmp1 = lstMember.length - 2;
  cmp2 = lstMember.length - 1;
  head1 = 0;
  head2 = 0;
  
  numQuestion = 1;
  finishSize = 0;
  finishFlag = 0;

  advanceHeadsToFirstValid(); 
}

function advanceHeadsToFirstValid() {
    if (cmp1 < 0 || finishFlag) return; 

    while (head1 < lstMember[cmp1].length && allMembers[lstMember[cmp1][head1]].isExcluded) {
        head1++;
        finishSize++; 
    }
    while (head2 < lstMember[cmp2].length && allMembers[lstMember[cmp2][head2]].isExcluded) {
        head2++;
        finishSize++; 
    }
}


function sortList(flag, excludedMemberOriginalIndex = -1){
  if (finishFlag) return;

  let choice1 = -1, choice2 = -1;

  if (excludedMemberOriginalIndex !== -1) {
    allMembers[excludedMemberOriginalIndex].isExcluded = true;
    currentTotalActiveMembers--; 
    
    if (lstMember[cmp1][head1] === excludedMemberOriginalIndex) { 
      flag = 1; 
    } else if (lstMember[cmp2][head2] === excludedMemberOriginalIndex) { 
      flag = -1; 
    }
  }
  
  choice1 = lstMember[cmp1][head1];
  choice2 = lstMember[cmp2][head2];

  if (flag < 0) { 
    rec[nrec++] = choice1;
    head1++;
    finishSize++;
    while (equal[rec[nrec-1]] != -1 && head1 < lstMember[cmp1].length) { 
        if(allMembers[lstMember[cmp1][head1]].isExcluded) { head1++; continue; }
        rec[nrec++] = lstMember[cmp1][head1++]; finishSize++;
    }
  } else if (flag > 0) { 
    rec[nrec++] = choice2;
    head2++;
    finishSize++;
     while (equal[rec[nrec-1]] != -1 && head2 < lstMember[cmp2].length) {
        if(allMembers[lstMember[cmp2][head2]].isExcluded) { head2++; continue; }
        rec[nrec++] = lstMember[cmp2][head2++]; finishSize++;
    }
  } else { 
    rec[nrec++] = choice1; head1++; finishSize++;
    while (equal[rec[nrec-1]] != -1 && head1 < lstMember[cmp1].length) {
        if(allMembers[lstMember[cmp1][head1]].isExcluded) { head1++; continue; }
        rec[nrec++] = lstMember[cmp1][head1++]; finishSize++;
    }
    
    equal[rec[nrec-1]] = choice2; 
    
    rec[nrec++] = choice2; head2++; finishSize++;
    while (equal[rec[nrec-1]] != -1 && head2 < lstMember[cmp2].length) {
        if(allMembers[lstMember[cmp2][head2]].isExcluded) { head2++; continue; }
        rec[nrec++] = lstMember[cmp2][head2++]; finishSize++;
    }
  }

  while (head1 < lstMember[cmp1].length && allMembers[lstMember[cmp1][head1]].isExcluded) {
    head1++; finishSize++; 
  }
  while (head2 < lstMember[cmp2].length && allMembers[lstMember[cmp2][head2]].isExcluded) {
    head2++; finishSize++;
  }

  if (head1 < lstMember[cmp1].length && head2 == lstMember[cmp2].length) {
    while (head1 < lstMember[cmp1].length) {
      if (!allMembers[lstMember[cmp1][head1]].isExcluded) {
        rec[nrec++] = lstMember[cmp1][head1]; finishSize++;
      } else {
        finishSize++; // Still count as processed for progress if excluded
      }
      head1++;
    }
  } else if (head1 == lstMember[cmp1].length && head2 < lstMember[cmp2].length) {
    while (head2 < lstMember[cmp2].length) {
      if (!allMembers[lstMember[cmp2][head2]].isExcluded) {
        rec[nrec++] = lstMember[cmp2][head2]; finishSize++;
      } else {
        finishSize++; // Still count as processed for progress if excluded
      }
      head2++;
    }
  }


  if (head1 == lstMember[cmp1].length && head2 == lstMember[cmp2].length) {
    for (let i=0; i < nrec; i++) { 
      lstMember[parent[cmp1]][i] = rec[i];
    }
    lstMember[parent[cmp1]].length = nrec;


    lstMember.pop(); lstMember.pop(); 
    cmp1 -= 2; cmp2 -= 2;
    head1 = 0; head2 = 0;
    
    for(let i = 0; i < allMembers.length; i++) rec[i] = 0; 
    nrec = 0;

    if (cmp1 >= 0) { 
       advanceHeadsToFirstValid();
    }
  }
  
  if (cmp1 < 0 || currentTotalActiveMembers < 2) { 
    let progress = initialTotalSize > 0 ? Math.floor(finishSize*100/initialTotalSize) : 100;
    if (progress > 100) progress = 100;
    document.getElementById("battleNumber").innerHTML = "Battle No."+(numQuestion-1)+"<br>"+ progress +"% sorted.";
    showResult(); 
    finishFlag = 1;
  } else {
    showImage();
  }
}

function handleExclude(originalMemberIndex, side) {
  if (finishFlag) return;
  
  let leftCandidateIndex = lstMember[cmp1][head1];
  let rightCandidateIndex = lstMember[cmp2][head2];

  if (originalMemberIndex === leftCandidateIndex) {
      sortList(1, originalMemberIndex); 
  } else if (originalMemberIndex === rightCandidateIndex) {
      sortList(-1, originalMemberIndex); 
  } else {
      console.error("Excluded member not in current battle pair.");
      return;
  }
  numQuestion++;
}


function showResult(){
  let str = "<h2>🏆 최종 순위 🏆</h2>";
  str += "<table>";
  str += "<tr><th>순위</th><th>이름</th></tr>";
  let ranking = 1, sameRank = 1;

  // Ensure lstMember[0] exists and is an array before filtering
  const finalActiveMembers = (lstMember && lstMember.length > 0 && Array.isArray(lstMember[0])) 
                             ? lstMember[0].filter(idx => !allMembers[idx].isExcluded)
                             : [];


  if (finalActiveMembers.length === 0) {
    str += "<tr><td colspan='2'>모든 후보가 제외되어 순위가 없습니다.</td></tr>";
  } else {
    for (let i = 0; i < finalActiveMembers.length; i++) {
      let memberOriginalIndex = finalActiveMembers[i];
      str += "<tr><td class='result-rank'>"+ranking+"</td><td class='result-name-cell'>"+getMemberCardHTML(memberOriginalIndex, 'result')+"</td></tr>";
      if (i < finalActiveMembers.length - 1) {
        let nextMemberOriginalIndex = finalActiveMembers[i+1];
        if (equal[memberOriginalIndex] === nextMemberOriginalIndex && !allMembers[memberOriginalIndex].isExcluded && !allMembers[nextMemberOriginalIndex].isExcluded) {
          sameRank++;
        } else { 
          ranking += sameRank; 
          sameRank = 1; 
        }
      }
    }
  }
  str += "</table>";

  // --- NEW: Add list of excluded members ---
  const excludedMembers = allMembers.filter(member => member.isExcluded);
  if (excludedMembers.length > 0) {
    const excludedNames = excludedMembers.map(member => member.nameStr).join(", ");
    str += `<div id="excludedNamesList"><strong>제외 된 이름:</strong> ${excludedNames}</div>`;
  }
  // --- END NEW ---

  document.getElementById("resultField").innerHTML = str;
}

function showImage(){
  if (finishFlag) return;

  advanceHeadsToFirstValid();

   if (head1 >= lstMember[cmp1].length && head2 >= lstMember[cmp2].length && cmp1 >=0 ) {
      sortList(0); 
      return;
   }
   if (cmp1 >=0 && head1 >= lstMember[cmp1].length) { 
        while(head2 < lstMember[cmp2].length) {
            if (!allMembers[lstMember[cmp2][head2]].isExcluded) rec[nrec++] = lstMember[cmp2][head2];
            else finishSize++; // Count excluded as processed
            head2++;
        }
        sortList(0); return; 
   }
   if (cmp1 >=0 && head2 >= lstMember[cmp2].length) { 
        while(head1 < lstMember[cmp1].length) {
            if (!allMembers[lstMember[cmp1][head1]].isExcluded) rec[nrec++] = lstMember[cmp1][head1];
             else finishSize++; // Count excluded as processed
            head1++;
        }
        sortList(0); return; 
   }


  if ((currentTotalActiveMembers < 2 || (cmp1 <0)) && !finishFlag) {
     let progress = initialTotalSize > 0 ? Math.floor(finishSize*100/initialTotalSize) : 100;
     if (progress > 100) progress = 100;
     document.getElementById("battleNumber").innerHTML = "Battle No."+(numQuestion-1)+"<br>"+progress+"% sorted.";
     showResult();
     finishFlag = 1;
     return;
  }

  let progress = initialTotalSize > 0 ? Math.floor(finishSize*100/initialTotalSize) : 0;
  if (progress > 100) progress = 100;

  document.getElementById("battleNumber").innerHTML =
    "Battle No." + numQuestion + "<br>" + progress + "% sorted.";

  let member1_idx = lstMember[cmp1][head1];
  let member2_idx = lstMember[cmp2][head2];

  document.getElementById("leftField").innerHTML = getMemberCardHTML(member1_idx, 'left');
  document.getElementById("rightField").innerHTML = getMemberCardHTML(member2_idx, 'right');

  numQuestion++;
}

function getMemberCardHTML(originalMemberIndex, side_or_context) {
  const member = allMembers[originalMemberIndex];
  // Safety check for member and images array
  if (!member || !member.images || member.images.length === 0) {
      return `<div class="member-card">Error: Member data incomplete for index ${originalMemberIndex}</div>`;
  }
  // Ensure currentImageIndex is valid
  if (member.currentImageIndex < 0 || member.currentImageIndex >= member.images.length) {
      member.currentImageIndex = 0;
  }

  const currentImage = member.images[member.currentImageIndex];
  const currentDisplayUrl = member.imageDisplayUrls[member.currentImageIndex];

  let nameHTML = `<span class='member-name'>
    <a href="${member.wikiLink}" target="_blank" style="color:blue;text-decoration:underline;">
      ${member.nameStr}
    </a>
  </span>`;
  
  let cardHTML = `
    <div class="member-card">
      <div class="img-box" id="img-box-${side_or_context}-${originalMemberIndex}" onclick="cycleImage(${originalMemberIndex}, '${side_or_context}')">
        <img src="${currentImage}" alt="${member.nameStr}" id="image-${side_or_context}-${originalMemberIndex}">
      </div>
      <div class="img-url-display" id="img-url-display-${side_or_context}-${originalMemberIndex}">${currentDisplayUrl}</div>
      ${nameHTML}
  `;

  if (side_or_context === 'left' || side_or_context === 'right') {
    let voteFlag = (side_or_context === 'left') ? -1 : 1;
    cardHTML += `
      <div class="button-container">
        <button onclick="sortList(${voteFlag})" class="vote-button">선택</button>
        <button onclick="handleExclude(${originalMemberIndex}, '${side_or_context}')" class="exclude-button">제외</button>
      </div>
    `;
  }
  cardHTML += `</div>`;
  return cardHTML;
}

function cycleImage(originalMemberIndex, side_or_context) {
  if (finishFlag && (side_or_context === 'left' || side_or_context === 'right')) return; 

  const member = allMembers[originalMemberIndex];
  if (!member || !member.images || member.images.length <= 1) return; 

  member.currentImageIndex = (member.currentImageIndex + 1) % member.images.length;
  
  const newImageSrc = member.images[member.currentImageIndex];
  const newDisplayUrl = member.imageDisplayUrls[member.currentImageIndex];

  const imgElement = document.getElementById(`image-${side_or_context}-${originalMemberIndex}`);
  const urlDisplayElement = document.getElementById(`img-url-display-${side_or_context}-${originalMemberIndex}`);

  if (imgElement) imgElement.src = newImageSrc;
  if (urlDisplayElement) urlDisplayElement.textContent = newDisplayUrl;
}


window.onload = function() {
    const ENABLE_RANDOM = false; 
    const RANDOM_SEED = 45; 
    
    let initialOrder = allMembers.map(m => m.id); 
    if (ENABLE_RANDOM && typeof seededRandom === 'function') { 
        shuffleArray(initialOrder); // Replace with shuffleArrayWithSeed if you implement it
    } else {
        shuffleArray(initialOrder);
    }
    
    const shuffledAllMembersObjects = initialOrder.map(id => {
        // Find the member object by id from the original allMembers array
        return allMembers.find(m => m.id === id);
    });
    
    // Replace allMembers with the shuffled version
    // Important: This assumes allMembers was defined with stable `id` properties from 0 to length-1 initially
    allMembers = shuffledAllMembersObjects;


    initList(); 
    if (!finishFlag) { 
        showImage(); 
    }
};

</script>
</head>
<body style="display: flex; flex-direction: column; align-items: center;">
<table id="mainTable">
  <tr>
     <td id="battleNumber" colspan="3">Loading...</td> 
  </tr>
  <tr>
    <td id="leftField"></td>
    <td style="width: 150px; vertical-align: middle;"> 
      <div class="middleField" style="margin-bottom: 10px;" onclick="if(finishFlag==0)sortList(0);">🤢 둘 다 개별로</div>
      <div class="middleField" onclick="if(finishFlag==0)sortList(0);">🔥 둘 다 꽤나 가능</div>
    </td>
    <td id="rightField"></td>
  </tr>
</table>

<br><br>
<div id="resultField" style="text-align:center;">
  <p><font size="5">이상형월드컵 V2.1</font></p>
  <p><font size="5">후보를 클릭하면 다른 이미지를 볼 수 있습니다 (설정된 경우). "제외" 버튼으로 싫은 후보를 뺄 수 있습니다.</font></p>
</div>

</body>
</html>
